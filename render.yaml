services:
  # 1. Tu servicio web principal (Backend + Frontend)
  - type: web
    name: gescon360-web
    env: node
    plan: free
    buildCommand: npm install
    startCommand: npm start
    envVars:
      - key: NODE_VERSION
        value: 20.11.0

  # 2. Cron Job para mantener Supabase activo
  # Ejecuta una petición diaria para evitar que Supabase pause el proyecto (pasa a inactivo tras 1 semana sin uso)
  # Nota: Los Cron Jobs en Render pueden tener un coste asociado según el plan.
  - type: cron
    name: keep-alive-supabase
    env: image
    image: curlimages/curl
    schedule: "0 8 * * *" # Ejecutar diariamente a las 08:00 UTC
    command: curl -s -f https://gescon360-web.onrender.com/health/supabase

  # 3. Cron Job para Reporte Diario de Carga de Trabajo
  # Genera Excel y envía email a todos los usuarios activos
  - type: cron
    name: daily-workload-report
    env: image
    image: curlimages/curl
    schedule: "0 7 * * *" # Ejecutar diariamente a las 07:00 UTC
    command: curl -X POST -H "x-cron-secret: gescon360_cron_secret_key" https://gescon360-web.onrender.com/api/cron/send-workload-report

  # 4. Cron Job para Rebalanceo Automático de Carga (OPTIMIZACIÓN 2)
  # Rebalancea tareas equitativamente entre usuarios activos
  - type: cron
    name: daily-workload-rebalance
    env: image
    image: curlimages/curl
    schedule: "0 2 * * *" # Ejecutar diariamente a las 02:00 UTC
    command: curl -X POST -H "x-cron-secret: gescon360_cron_secret_key" https://gescon360-web.onrender.com/api/cron/rebalance